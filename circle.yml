machine:
  python:
    version: 3.6.1

dependencies:
  pre:
    - sudo add-apt-repository -y ppa:migurski/planscore
    - sudo apt-get update -y
    - sudo apt-get install -y libgeos-c1v5=3.5.0-1~trusty1 libgdal20=2.1.0+dfsg-1~trusty2 libgdal-dev=2.1.0+dfsg-1~trusty2
  override:
    - CPLUS_INCLUDE_PATH=/usr/include/gdal C_INCLUDE_PATH=/usr/include/gdal pip install "GDAL <= `gdal-config --version`"
    - pip install .

test:
  override:
    - python setup.py test

deployment:
  production:
    branch: [master]
    commands:
      - make live-lambda
      - make live-website
  production:
    branch: [migurski/support-north-carolina]
    commands:
      - make planscore-lambda.zip
      - aws --region us-east-1 lambda update-function-code --function-name PlanScore-RunDistrict --zip-file fileb://planscore-lambda.zip >> /dev/null
      - aws --region us-east-1 lambda update-function-configuration --function-name PlanScore-RunDistrict --handler lambda.run_district >> /dev/null
